(function(b){function g(a,c,e){this.src=a;this.loaded=!1;this.spinner=b("<div/>",{"class":"spinner"});this.fitScreen=e.fitScreen;this.visible=!1;this.container=c;this.container.append(this.spinner);this.fadeDuration=e.fadeDuration}function f(a,c){this.settings=b.extend(!0,{fitScreen:!0,imageFadeDuration:200,wrap:!0,fullscreen:!0,showCounter:!0,showInfo:!0,showThumbs:!0,showResizeButton:!0,thumbsAlwaysVisible:!1,thumbsFadeDuration:200,thumbsHideTimeout:1E3},c);this.index=null;this.pictures=[];this.container=
a;this.container.data("gallerize",this);this.open=!1;this.fitScreen=this.settings.fitScreen;this.screen=b("<div>",{"class":"gallerize"}).appendTo(b("body"));var e=this,d=a.find("a > img");0==d.length&&b.error("[jQuery.gallerize] No pictures found.");d.each(function(){var a=b(this),d=a.parent(),c=new g(d.attr("href"),e.screen,e.settings);c.thumbSrc=a.attr("src");c.title=d.attr("title");c.description=a.attr("alt");a=e.pictures.push(c)-1;d.data("gallerize",{gallerize:e,index:a});d.click(function(a){a.preventDefault();
a=b(this).data("gallerize");b.proxy(a.gallerize.show,a.gallerize)(a.index)})});this.settings.showCounter&&(this.counter=b("<div/>",{"class":"counter box"}).appendTo(this.screen));this.settings.showInfo&&(this.info=b("<div/>",{"class":"info box"}).appendTo(this.screen));this.settings.showThumbs&&this.createThumbs();this.buttons=b("<div/>",{"class":"buttons"}).appendTo(this.screen);this.buttonClose=b("<div/>",{"class":"btn btn-close"}).appendTo(this.buttons).click(b.proxy(function(){this.close()},this));
this.settings.showResizeButton&&(this.buttonRealSize=b("<div/>",{"class":"btn btn-real-size"}).appendTo(this.buttons).click(b.proxy(function(){this.buttonRealSize.hide();this.buttonFitScreen.show();this.setSize(false)},this)),this.buttonFitScreen=b("<div/>",{"class":"btn btn-fit-screen"}).appendTo(this.buttons).click(b.proxy(function(){this.buttonRealSize.show();this.buttonFitScreen.hide();this.setSize(true)},this)),this.fitScreen?this.buttonFitScreen.hide():this.buttonRealSize.hide());b("<div/>",
{"class":"arrow arrow-left"}).appendTo(this.screen).click(b.proxy(this.previous,this));b("<div/>",{"class":"arrow arrow-right"}).appendTo(this.screen).click(b.proxy(this.next,this))}function j(a){return this.each(function(){var c=b(this);c.data("gallerize",new f(c,a))})}g.prototype.load=function(){this.loaded||(this.image=b("<img/>",{"class":"picture"}),this.image.load(b.proxy(this.onLoaded,this)),this.image.attr("src",this.src))};g.prototype.onLoaded=function(){this.loaded=!0;this.spinner.replaceWith(this.image);
this.visible&&(this.show(),this.resize())};g.prototype.setSize=function(a){this.fitScreen=a;this.loaded&&this.resize()};g.prototype.resize=function(a){if(this.loaded){a||this.image.css("width","auto").css("height","auto");var a=this.container.width(),b=this.container.height(),e=this.image.width(),d=this.image.height();this.fitScreen||d>b||e>a?e/d>a/b?this.image.css("width","100%").css("top",(b-this.image.height())/2+"px").css("left","0"):this.image.css("height","100%").css("top","0").css("left",(a-
this.image.width())/2+"px"):this.fitScreen||this.image.css("top",(b-d)/2+"px").css("left",(a-e)/2+"px")}};g.prototype.show=function(a){a="undefined"==typeof a?!1:a;this.loaded?(a?this.image.show():this.image.fadeIn(this.fadeDuration),this.resize()):this.spinner.show();this.visible=!0};g.prototype.hide=function(a){this.loaded?("undefined"==typeof a?0:a)?this.image.hide():this.image.fadeOut(this.fadeDuration):this.spinner.hide();this.visible=!1};f.prototype.setSize=function(a){var b;this.fitScreen=
a;for(b=0;b<this.pictures.length;b++)this.pictures[b].setSize(a)};f.prototype.createThumbs=function(){this.thumbsWrapper=b("<div/>",{"class":"bar-wrapper"}).appendTo(this.screen);this.bar=b("<div/>",{"class":"bar box"}).appendTo(this.thumbsWrapper);this.thumbsPadding=b("<div/>",{"class":"padding"}).appendTo(this.bar);this.thumbs=b("<div/>",{"class":"thumbs"}).appendTo(this.thumbsPadding);this.scroller=b("<div/>",{"class":"scroller"}).appendTo(this.thumbs);this.thumbsInner=b("<div/>").appendTo(this.scroller).css("float",
"left");var a,c=b.proxy(function(a){this.switchPicture(parseInt(a.data.index,10))},this);for(a=0;a<this.pictures.length;a++){var e=this.pictures[a];e.thumb=b("<div/>",{"class":"thumb"}).append(b("<img/>",{src:e.thumbSrc}),b("<div/>",{"class":"overlay"})).appendTo(this.thumbsInner);e.thumb.click({index:a},c)}this.thumbs.mousemove({thumbs:this.thumbs,inner:this.thumbsInner,scroller:this.scroller},function(a){var b=a.data.thumbs.width(),c=a.data.inner.width();c<=b||a.data.scroller.css("left",-(a.clientX/
b*(c-b))+"px")});this.settings.thumbsAlwaysVisible?this.bar.show():(this.bar.hide(),this.bar.data("gallerize",{hover:!1}),this.thumbsWrapper.mouseover({bar:this.bar,duration:this.settings.thumbsFadeDuration},function(a){var b=a.data.bar.data("gallerize");b.hover||(b.hover=!0,a.data.bar.stop().fadeIn(a.data.duration))}),this.thumbsWrapper.mouseleave({bar:this.bar,duration:this.settings.thumbsFadeDuration,timeout:this.settings.thumbsHideTimeout},function(a){a.data.bar.data("gallerize").hover=!1;setTimeout(function(){a.data.bar.data("gallerize").hover||
a.data.bar.stop().fadeOut(a.data.duration)},a.data.timeout)}))};f.prototype.show=function(a){if(this.open)return this.switchPicture(a);this.open=!0;b(document).bind("keyup.gallerize",b.proxy(this.onKeyUp,this));b(window).bind("resize.gallerize",b.proxy(this.onResize,this));this.screen.show();"undefined"==typeof a&&null===this.index?this.switchPicture(0,!0):this.switchPicture(a,!0);this.settings.fullscreen&&this.enableFullScreen()};f.prototype.switchPicture=function(a,c){if("undefined"!=typeof a&&
a!==this.index){var e=null===this.index?null:this.pictures[this.index],d=this.pictures[a];if(this.settings.showThumbs){d.thumb.find(".overlay").toggleClass("selected");var f=this.scroller.position().left,g=d.thumb.position().left,h=g+d.thumb.width(),i=this.thumbs.width();h+f>i&&(f=i-h);0>g+f&&(f=-g);this.scroller.animate({left:f+"px"},this.settings.imageFadeDuration);null!==e&&e.thumb.find(".overlay").toggleClass("selected")}this.index=a;d.load();this.pictures[this.getNextIndex()].load();this.pictures[this.getPreviousIndex()].load();
null!==e&&e.hide(c);d.show(c);this.settings.showCounter&&this.counter.html(this.index+1+" / "+this.pictures.length);this.settings.showInfo&&(d.description||d.title?(this.info.html(""),d.title&&b("<div/>",{"class":"title"}).html(d.title).appendTo(this.info),d.description&&b("<div/>",{"class":"description"}).html(d.description).appendTo(this.info),this.info.is(":visible")||this.info.fadeIn(this.settings.fadeDuration)):this.info.is(":visible")&&this.info.fadeOut(this.settings.fadeDuration))}};f.prototype.close=
function(){this.open&&(this.open=!1,b(document).unbind("keyup.gallerize"),b(window).unbind("resize.gallerize"),this.screen.hide(),this.settings.fullscreen&&this.disableFullScreen())};f.prototype.getNextIndex=function(){var a=this.index+1;return a==this.pictures.length?!this.settings.wrap?this.index:0:a};f.prototype.getPreviousIndex=function(){var a=this.index-1;return 0>a?!this.settings.wrap?this.index:this.pictures.length-1:a};f.prototype.next=function(){this.switchPicture(this.getNextIndex())};
f.prototype.previous=function(){this.switchPicture(this.getPreviousIndex())};f.prototype.onResize=function(){null!==this.index&&this.pictures[this.index].resize()};f.prototype.onKeyUp=function(a){27==a.which&&(a.preventDefault(),this.close());if(37==a.which||8==a.which)a.preventDefault(),this.previous();if(39==a.which||32==a.which)a.preventDefault(),this.next()};f.prototype.enableFullScreen=function(){var a=this.screen.get(0);"undefined"!=typeof a.requestFullScreen?a.requestFullScreen():"undefined"!=
typeof a.webkitRequestFullScreen?a.webkitRequestFullScreen():"undefined"!=typeof a.mozRequestFullScreen&&a.mozRequestFullScreen()};f.prototype.disableFullScreen=function(){"undefined"!=typeof document.cancelFullScreen?document.cancelFullScreen():"undefined"!=typeof document.webkitCancelFullScreen?document.webkitCancelFullScreen():"undefined"!=typeof document.mozCancelFullScreen&&document.mozCancelFullScreen()};b.fn.gallerize=function(a){if(0==this.length)return this;if("object"===typeof a||!a)return j.apply(this,
arguments);switch(a){case "show":1!=this.length&&b.error("[jQuery.gallerize] You cannot show multiple galleries at once!");var c=b(this[0]).data("gallerize");"undefined"==typeof c&&b.error("[jQuery.gallerize] Gallerize has not been initialized on this element!");return c.show.apply(c,Array.prototype.slice.call(arguments,1));default:b.error("[jQuery.gallerize] Method "+a+" does not exist.")}}})(jQuery);
