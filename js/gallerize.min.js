/*!
 *   Gallerize - A jQuery Fullscreen Gallery Plugin                         
 *   2012 (c) Filip Sobalski <pinkeen@gmail.com>                            
 *                                                                       
 *   Permission is hereby granted, free of charge, to any person obtaining  
 *   a copy of this software and associated documentation files (the        
 *   "Software"), to deal in the Software without restriction, including    
 *   without limitation the rights to use, copy, modify, merge, publish,    
 *   distribute, sublicense, and/or sell copies of the Software, and to     
 *   permit persons to whom the Software is furnished to do so, subject to  
 *   the following conditions:                                              
 *                                                                        
 *   The above copyright notice and this permission notice shall be         
 *   included in all copies or substantial portions of the Software.        
 *                                                                        
 *   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,        
 *   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF     
 *   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND                  
 *   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE 
 *   LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
 *   OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION  
 *   WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.        
 */
(function(c){function b(g,e,f){this.src=g;this.loaded=false;this.spinner=c(f.spinner);this.fitScreen=f.fitScreen;this.visible=false;this.container=e;this.container.append(this.spinner);this.fadeDuration=f.imageFadeDuration}b.prototype.load=function(){if(this.loaded){return}this.image=c("<img/>",{"class":"picture"});this.image.load(c.proxy(this.onLoaded,this));this.container.append(this.image);this.image.attr("src",this.src)};b.prototype.onLoaded=function(){if(this.loaded){return}this.loaded=true;this.spinner.replaceWith(this.image);if(this.visible){this.show();this.resize()}};b.prototype.setSize=function(e){this.fitScreen=e;if(!this.loaded){return}this.resize()};b.prototype.resize=function(k){if(!this.loaded){return}if(!k){this.image.css("width","auto").css("height","auto")}var j=this.container.width(),i=this.container.height(),g=this.image.width(),e=this.image.height();if(this.fitScreen||e>i||g>j){var h=j/i,f=g/e;if(f>h){this.image.css("width","100%").css("top",(i-this.image.height())/2+"px").css("left","0")}else{this.image.css("height","100%").css("top","0").css("left",(j-this.image.width())/2+"px")}}else{if(!this.fitScreen){this.image.css("top",(i-e)/2+"px").css("left",(j-g)/2+"px")}}};b.prototype.show=function(e){e=typeof e=="undefined"?false:e;if(this.loaded){if(e){this.image.show()}else{this.image.fadeIn(this.fadeDuration,"linear")}this.resize()}else{this.spinner.show()}this.visible=true};b.prototype.hide=function(e){e=typeof e=="undefined"?false:e;if(this.loaded){if(e){this.image.hide()}else{this.image.fadeOut(this.fadeDuration,"linear")}}else{this.spinner.hide()}this.visible=false};function a(f,i){this.settings=c.extend(true,{fitScreen:true,wrap:true,fullscreen:false,preloadAll:false,showCounter:true,showInfo:true,showThumbs:true,showResizeButton:true,imageFadeDuration:0,thumbsAlwaysVisible:false,thumbsFadeDuration:200,thumbsHideTimeout:500,arrowsFadeDuration:300,thumbSlideDuration:300,extension:null,title:null,spinner:'<div class="spinner"></div>'},i);this.index=null;this.pictures=[];this.container=f;this.container.data("gallerize",this);this.open=false;this.fitScreen=this.settings.fitScreen;this.screen=c("<div/>",{"class":"gallerize"}).appendTo(c("body"));this.details=c("<div/>",{"class":"details"}).appendTo(this.screen);if(this.container.attr("title")){this.settings.title=this.container.attr("title")}if(this.settings.title!==null){c("<div/>",{"class":"title box"}).html(this.settings.title).appendTo(this.details)}var g=this,j=f.find("a > img");if(j.length==0){c.error("[jQuery.gallerize] No pictures found.")}j.each(function(){var l=c(this),k=l.parent(),n=new b(k.attr("href"),g.screen,g.settings);n.thumbSrc=l.attr("src");n.title=k.attr("title");n.description=l.attr("alt");if(g.settings.preloadAll){n.load()}var m=g.pictures.push(n)-1;k.data("gallerize",{gallerize:g,index:m});k.click(function(o){o.preventDefault();var p=c(this).data("gallerize");c.proxy(p.gallerize.show,p.gallerize)(p.index)})});if(this.settings.showCounter){this.counter=c("<div/>",{"class":"counter box"}).appendTo(this.details)}if(this.settings.showInfo){this.info=c("<div/>",{"class":"info box"}).appendTo(this.screen)}if(this.settings.showThumbs){this.createThumbs()}this.buttons=c("<div/>",{"class":"buttons"}).appendTo(this.screen);this.buttonClose=c("<div/>",{"class":"btn btn-close"}).appendTo(this.buttons).click(c.proxy(function(){this.close()},this));if(this.settings.showResizeButton){this.buttonRealSize=c("<div/>",{"class":"btn btn-real-size"}).appendTo(this.buttons).click(c.proxy(function(){this.buttonRealSize.hide();this.buttonFitScreen.show();this.setSize(false)},this));this.buttonFitScreen=c("<div/>",{"class":"btn btn-fit-screen"}).appendTo(this.buttons).click(c.proxy(function(){this.buttonRealSize.show();this.buttonFitScreen.hide();this.setSize(true)},this));if(this.fitScreen){this.buttonFitScreen.hide()}else{this.buttonRealSize.hide()}}var h=this.settings.arrowsFadeDuration,e=function(){c(this).find(".arrow").stop().fadeToggle(h)};c("<div/>",{"class":"arrow-area arrow-area-left"}).append(c("<div/>",{"class":"arrow arrow-left"})).appendTo(this.screen).click(c.proxy(this.previous,this)).hover(e,e);c("<div/>",{"class":"arrow-area arrow-area-right"}).append(c("<div/>",{"class":"arrow arrow-right"})).appendTo(this.screen).click(c.proxy(this.next,this)).hover(e,e);if(this.settings.extension!==null){if(typeof this.settings.extension!=="function"){c.error("[jQuery.gallerize] The extension should be a function!")}this.settings.extension(this,screen)}}a.prototype.setSize=function(f){var e;this.fitScreen=f;for(e=0;e<this.pictures.length;e++){this.pictures[e].setSize(f)}};a.prototype.createThumbs=function(){this.thumbsWrapper=c("<div/>",{"class":"thumbs-wrapper"}).appendTo(this.screen);this.thumbs=c("<div/>",{"class":"thumbs"}).appendTo(this.thumbsWrapper);this.scroller=c("<div/>",{"class":"scroller"}).appendTo(this.thumbs);this.thumbsInner=c("<div/>").appendTo(this.scroller).css("float","left");var e,f=c.proxy(function(h){this.switchPicture(parseInt(h.data.index,10))},this);for(e=0;e<this.pictures.length;e++){var g=this.pictures[e];g.thumb=c("<div/>",{"class":"thumb"}).append(c("<img/>",{src:g.thumbSrc}),c("<div/>",{"class":"overlay"})).appendTo(this.thumbsInner);g.thumb.click({index:e},f)}this.thumbs.mousemove({thumbs:this.thumbs,inner:this.thumbsInner,scroller:this.scroller},function(k){if(k.data.scroller.is(":animated")){return}var j=k.data.thumbs.width(),i=k.data.inner.width(),h;if(i<=j){return}h=(k.clientX/j)*(i-j);k.data.scroller.css("left",-h+"px")});if(this.settings.thumbsAlwaysVisible){this.thumbs.show()}else{this.thumbs.hide();this.thumbs.data("gallerize",{hover:false});this.thumbsWrapper.mouseover({bar:this.thumbs,duration:this.settings.thumbsFadeDuration},function(h){var i=h.data.bar.data("gallerize");if(i.hover){return}i.hover=true;h.data.bar.stop().fadeIn(h.data.duration,"linear")});this.thumbsWrapper.mouseleave({bar:this.thumbs,duration:this.settings.thumbsFadeDuration,timeout:this.settings.thumbsHideTimeout},function(h){h.data.bar.data("gallerize").hover=false;setTimeout(function(){if(h.data.bar.data("gallerize").hover){return}h.data.bar.stop().fadeOut(h.data.duration,"linear")},h.data.timeout)})}};a.prototype.show=function(e){if(this.open){return this.switchPicture(e)}this.open=true;c(document).bind("keyup.gallerize",c.proxy(this.onKeyUp,this));c(window).bind("resize.gallerize",c.proxy(this.onResize,this));this.screen.bind("mousewheel.gallerize",c.proxy(this.onMouseWheel,this));this.screen.show();if(typeof e=="undefined"&&this.index===null){this.switchPicture(0,true)}else{this.switchPicture(e,true)}if(this.settings.fullscreen){this.enableFullScreen()}};a.prototype.close=function(){if(!this.open){return}this.open=false;c(document).unbind("keyup.gallerize");c(window).unbind("resize.gallerize");this.screen.unbind("mousewheel.gallerize");this.screen.hide();if(this.settings.fullscreen){this.disableFullScreen()}};a.prototype.switchPicture=function(k,g){if(typeof k=="undefined"){return}if(k===this.index){return}var i=this.index===null?null:this.pictures[this.index],h=this.pictures[k];if(this.settings.showThumbs){h.thumb.toggleClass("selected");var m=this.scroller.position().left,j=h.thumb.position().left,e=j+h.thumb.width(),f=this.thumbs.width(),l=m;if((e+m)>f){l=f-e}if((j+m)<0){l=-j}if(l!=m){this.scroller.stop(true).animate({left:l+"px"},this.settings.thumbSlideDuration,"linear")}if(i!==null){i.thumb.toggleClass("selected")}}this.index=k;h.load();this.pictures[this.getNextIndex()].load();this.pictures[this.getPreviousIndex()].load();if(i!==null){i.hide(g)}h.show(g);if(this.settings.showCounter){this.counter.html((this.index+1)+" / "+this.pictures.length)}if(this.settings.showInfo){if(h.description||h.title){this.info.html("");if(h.title){c("<div/>",{"class":"title"}).html(h.title).appendTo(this.info)}if(h.description){c("<div/>",{"class":"description"}).html(h.description).appendTo(this.info)}if(!this.info.is(":visible")){this.info.fadeIn(this.settings.imageFadeDuration,"linear")}}else{if(this.info.is(":visible")){this.info.fadeOut(this.settings.imageFadeDuration,"linear")}}}};a.prototype.getNextIndex=function(){var e=this.index+1;if(e==this.pictures.length){if(!this.settings.wrap){return this.index}return 0}return e};a.prototype.getPreviousIndex=function(){var e=this.index-1;if(e<0){if(!this.settings.wrap){return this.index}return this.pictures.length-1}return e};a.prototype.next=function(){this.switchPicture(this.getNextIndex())};a.prototype.previous=function(){this.switchPicture(this.getPreviousIndex())};a.prototype.onMouseWheel=function(g,h,f,e){g.preventDefault();if(e>0){this.next()}if(e<0){this.previous()}};a.prototype.onResize=function(){if(this.index===null){return}this.pictures[this.index].resize()};a.prototype.onKeyUp=function(e){if(e.which==27){e.preventDefault();this.close()}if(e.which==37||e.which==8){e.preventDefault();this.previous()}if(e.which==39||e.which==32){e.preventDefault();this.next()}};a.prototype.enableFullScreen=function(){var e=this.screen.get(0);if(typeof e.requestFullScreen!="undefined"){e.requestFullScreen()}else{if(typeof e.webkitRequestFullScreen!="undefined"){e.webkitRequestFullScreen()}else{if(typeof e.mozRequestFullScreen!="undefined"){e.mozRequestFullScreen()}}}};a.prototype.disableFullScreen=function(){if(typeof document.cancelFullScreen!="undefined"){document.cancelFullScreen()}else{if(typeof document.webkitCancelFullScreen!="undefined"){document.webkitCancelFullScreen()}else{if(typeof document.mozCancelFullScreen!="undefined"){document.mozCancelFullScreen()}}}};function d(e){return this.each(function(){var f=c(this);f.data("gallerize",new a(f,e))})}c.fn.gallerize=function(f){if(this.length==0){return this}if(typeof f==="object"||!f){return d.apply(this,arguments)}switch(f){case"show":if(this.length!=1){c.error("[jQuery.gallerize] You cannot show multiple galleries at once!")}var e=c(this[0]).data("gallerize");if(typeof e=="undefined"){c.error("[jQuery.gallerize] Gallerize has not been initialized on this element!")}return e.show.apply(e,Array.prototype.slice.call(arguments,1));default:c.error("[jQuery.gallerize] Method "+f+" does not exist.")}}})(jQuery);