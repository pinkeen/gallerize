/*!
 *   Gallerize - A jQuery Fullscreen Gallery Plugin                         
 *   2012 (c) Filip Sobalski <pinkeen@gmail.com>                            
 *                                                                        
 *   Licensed under the MIT License.
 */
(function(c){function b(f,e,g){this.src=f.src;this.thumb=f.thumb;this.title=f.title;this.description=f.description;this.loaded=false;this.visible=false;this.fitScreen=g.fitScreen;this.container=e;this.spinner=c('<div class="spinner"></div>').appendTo(this.container)}b.prototype.load=function(){if(this.loaded){return}this.wrapper=c('<div class="picture"></div>');if(this.title||this.description){var e=c('<div class="info box"></div>').appendTo(this.wrapper);if(this.title){c('<div class="title"></div>').html(this.title).appendTo(e)}if(this.description){c('<div class="description"></div>').html(this.description).appendTo(e)}}this.image=c("<img/>").appendTo(this.wrapper);this.image.load(c.proxy(this.onLoaded,this));this.image.attr("src",this.src);this.container.append(this.wrapper)};b.prototype.onLoaded=function(){if(this.loaded){return}this.loaded=true;this.spinner.replaceWith(this.wrapper);this.width=this.image[0].width;this.height=this.image[0].height;this.ratio=this.width/this.height;if(this.visible){this.show();this.resize()}};b.prototype.setSize=function(e){this.fitScreen=e;if(!this.loaded){return}this.resize()};b.prototype.resize=function(l){if(!this.loaded){return}var i=this.container.width(),h=this.container.height(),g=i/h,f,e,j,k;if(this.fitScreen||this.height>h||this.width>i){if(this.ratio>g){f=i;e=f/this.ratio;k=0;j=(h-e)/2}else{e=h;f=e*this.ratio;j=0;k=(i-f)/2}}else{if(!this.fitScreen){f=this.width;e=this.height;k=(i-f)/2;j=(h-e)/2}}this.image.css("width",Math.floor(f)+"px");this.image.css("height",Math.floor(e)+"px");this.wrapper.css("left",Math.floor(k)+"px");this.wrapper.css("top",Math.floor(j)+"px")};b.prototype.show=function(){if(this.loaded){this.wrapper.addClass("picture-current");this.resize()}else{this.spinner.show()}this.visible=true};b.prototype.hide=function(){if(this.loaded){this.wrapper.removeClass("picture-current")}else{this.spinner.hide()}this.visible=false};function a(e,g){this.settings=c.extend(true,{fitScreen:true,wrap:true,fullscreen:false,preloadAll:false,showCounter:true,showInfo:true,showThumbs:true,thumbSlideDuration:300},g);this.index=null;this.pictures=[];this.container=e;this.container.data("gallerize",this);this.open=false;this.fitScreen=this.settings.fitScreen;this.screen=c('<div class="gallerize"></div>').appendTo(c("body"));var f=this,h=e.find("a > img");if(h.length==0){c.error("[jQuery.gallerize] No pictures found.")}h.each(function(){var j=c(this),i=j.parent(),k={src:i.attr("href"),thumb:j.attr("src"),title:i.attr("title"),description:j.attr("alt")},l=new b(k,f.screen,f.settings);if(f.settings.preloadAll){l.load()}i.data("gallerize",{gallerize:f,index:f.pictures.push(l)-1});i.click(function(m){var n=c(this).data("gallerize");m.preventDefault();n.gallerize.show(n.index)})});if(this.settings.showThumbs){this.createThumbs()}c('<div class="buttons"></div>').appendTo(this.screen).append(c('<div class="btn btn-close"></div>').click(function(){f.close()}));c('<div class="arrow-area arrow-area-left"><div class="arrow arrow-left"></div></div>').appendTo(this.screen).click(function(){f.previous()});c('<div class="arrow-area arrow-area-right"><div class="arrow arrow-right"></div></div>').appendTo(this.screen).click(function(){f.next()})}a.prototype.setSize=function(f){this.fitScreen=f;for(var e=0;e<this.pictures.length;e++){this.pictures[e].setSize(f)}};a.prototype.createThumbs=function(){this.thumbsWrapper=c("<div/>",{"class":"thumbs-wrapper"}).appendTo(this.screen);this.thumbs=c("<div/>",{"class":"thumbs"}).appendTo(this.thumbsWrapper);this.scroller=c("<div/>",{"class":"scroller"}).appendTo(this.thumbs);this.thumbsInner=c("<div/>").appendTo(this.scroller).css("float","left");var e,f=c.proxy(function(h){this.switchPicture(parseInt(h.data.index,10))},this);for(e=0;e<this.pictures.length;e++){var g=this.pictures[e];g.thumb=c("<div/>",{"class":"thumb"}).append(c("<img/>",{src:g.thumb}).on("dragstart",function(){return false}),c("<div/>",{"class":"overlay"})).appendTo(this.thumbsInner);g.thumb.click({index:e},f)}this.thumbs.mousemove({thumbs:this.thumbs,inner:this.thumbsInner,scroller:this.scroller},function(k){if(k.data.scroller.is(":animated")){k.data.scroller.stop()}var j=k.data.thumbs.width(),i=k.data.inner.width(),h;if(i<=j){return}h=Math.round((k.clientX/j)*(i-j));k.data.scroller.css("left",-h+"px")});if(this.settings.thumbsAlwaysVisible){this.thumbs.show()}};a.prototype.show=function(e){if(this.open){return this.switchPicture(e)}this.open=true;c(document).bind("keyup.gallerize",c.proxy(this.onKeyUp,this));c(window).bind("resize.gallerize",c.proxy(this.onResize,this));this.screen.bind("mousewheel.gallerize",c.proxy(this.onMouseWheel,this));this.screen.show();if(typeof e=="undefined"&&this.index===null){this.switchPicture(0,true)}else{this.switchPicture(e,true)}if(this.settings.fullscreen){this.enableFullScreen()}};a.prototype.close=function(){if(!this.open){return}this.open=false;c(document).unbind("keyup.gallerize");c(window).unbind("resize.gallerize");this.screen.unbind("mousewheel.gallerize");this.screen.hide();if(this.settings.fullscreen){this.disableFullScreen()}};a.prototype.switchPicture=function(e){if(typeof e=="undefined"){return}if(e===this.index){return}var g=this.index===null?null:this.pictures[this.index],j=this.pictures[e];if(this.settings.showThumbs){j.thumb.toggleClass("selected");var l=this.scroller.position().left,i=j.thumb.position().left,h=i+j.thumb.width(),f=this.thumbs.width(),k=l;if((h+l)>f){k=f-h}if((i+l)<0){k=-i}if(k!=l){this.scroller.stop(true).animate({left:k+"px"},this.settings.thumbSlideDuration,"linear")}if(g!==null){g.thumb.toggleClass("selected")}}this.index=e;j.load();this.pictures[this.getNextIndex()].load();this.pictures[this.getPreviousIndex()].load();if(g!==null){g.hide()}j.show()};a.prototype.getNextIndex=function(){var e=this.index+1;if(e==this.pictures.length){if(!this.settings.wrap){return this.index}return 0}return e};a.prototype.getPreviousIndex=function(){var e=this.index-1;if(e<0){if(!this.settings.wrap){return this.index}return this.pictures.length-1}return e};a.prototype.next=function(){this.switchPicture(this.getNextIndex())};a.prototype.previous=function(){this.switchPicture(this.getPreviousIndex())};a.prototype.onMouseWheel=function(g,h,f,e){g.preventDefault();if(e>0){this.next()}if(e<0){this.previous()}};a.prototype.onResize=function(){if(this.index===null){return}this.pictures[this.index].resize()};a.prototype.onKeyUp=function(e){if(e.which==27){e.preventDefault();this.close()}if(e.which==37||e.which==8){e.preventDefault();this.previous()}if(e.which==39||e.which==32){e.preventDefault();this.next()}};a.prototype.enableFullScreen=function(){var e=this.screen.get(0);if(typeof e.requestFullScreen!="undefined"){e.requestFullScreen()}else{if(typeof e.webkitRequestFullScreen!="undefined"){e.webkitRequestFullScreen()}else{if(typeof e.mozRequestFullScreen!="undefined"){e.mozRequestFullScreen()}}}};a.prototype.disableFullScreen=function(){if(typeof document.cancelFullScreen!="undefined"){document.cancelFullScreen()}else{if(typeof document.webkitCancelFullScreen!="undefined"){document.webkitCancelFullScreen()}else{if(typeof document.mozCancelFullScreen!="undefined"){document.mozCancelFullScreen()}}}};function d(e){return this.each(function(){var f=c(this);f.data("gallerize",new a(f,e))})}c.fn.gallerize=function(f){if(this.length==0){return this}if(typeof f==="object"||!f){return d.apply(this,arguments)}switch(f){case"show":if(this.length!=1){c.error("[jQuery.gallerize] You cannot show multiple galleries at once!")}var e=c(this[0]).data("gallerize");if(typeof e=="undefined"){c.error("[jQuery.gallerize] Gallerize has not been initialized on this element!")}return e.show.apply(e,Array.prototype.slice.call(arguments,1));default:c.error("[jQuery.gallerize] Method "+f+" does not exist.")}}})(jQuery);